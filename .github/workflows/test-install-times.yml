name: Test Install Times

on:
  pull_request:
    branches: [main]
    paths:
      - '.github/workflows/test-install-times.yml'

jobs:
  next-install:
    runs-on: ubuntu-latest
    outputs:
      time: ${{ steps.measure.outputs.time }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Measure Next.js install time
        id: measure
        run: |
          cp -r packages/starter-next-js /tmp/next-test
          cd /tmp/next-test
          START=$(date +%s%N)
          pnpm install
          END=$(date +%s%N)
          ELAPSED=$((($END - $START) / 1000000))
          echo "time=$ELAPSED" >> $GITHUB_OUTPUT
          echo "Next.js install time: ${ELAPSED}ms"

  react-router-install:
    runs-on: ubuntu-latest
    outputs:
      time: ${{ steps.measure.outputs.time }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Measure React Router install time
        id: measure
        run: |
          cp -r packages/starter-react-router /tmp/react-router-test
          cd /tmp/react-router-test
          START=$(date +%s%N)
          pnpm install
          END=$(date +%s%N)
          ELAPSED=$((($END - $START) / 1000000))
          echo "time=$ELAPSED" >> $GITHUB_OUTPUT
          echo "React Router install time: ${ELAPSED}ms"

  tanstack-install:
    runs-on: ubuntu-latest
    outputs:
      time: ${{ steps.measure.outputs.time }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Measure TanStack Start install time
        id: measure
        run: |
          cp -r packages/starter-tanstack-start-react /tmp/tanstack-test
          cd /tmp/tanstack-test
          START=$(date +%s%N)
          pnpm install
          END=$(date +%s%N)
          ELAPSED=$((($END - $START) / 1000000))
          echo "time=$ELAPSED" >> $GITHUB_OUTPUT
          echo "TanStack Start install time: ${ELAPSED}ms"

  nuxt-install:
    runs-on: ubuntu-latest
    outputs:
      time: ${{ steps.measure.outputs.time }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Measure Nuxt install time
        id: measure
        run: |
          cp -r packages/starter-nuxt /tmp/nuxt-test
          cd /tmp/nuxt-test
          START=$(date +%s%N)
          pnpm install
          END=$(date +%s%N)
          ELAPSED=$((($END - $START) / 1000000))
          echo "time=$ELAPSED" >> $GITHUB_OUTPUT
          echo "Nuxt install time: ${ELAPSED}ms"

  summary:
    runs-on: ubuntu-latest
    needs: [next-install, react-router-install, tanstack-install, nuxt-install]
    steps:
      - name: Summary
        run: |
          echo "## Install Time Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Each framework was installed on a fresh runner for fair comparison." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Framework | Install Time |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|-------------|" >> $GITHUB_STEP_SUMMARY
          echo "| Next.js | ${{ needs.next-install.outputs.time }}ms |" >> $GITHUB_STEP_SUMMARY
          echo "| React Router | ${{ needs.react-router-install.outputs.time }}ms |" >> $GITHUB_STEP_SUMMARY
          echo "| TanStack Start | ${{ needs.tanstack-install.outputs.time }}ms |" >> $GITHUB_STEP_SUMMARY
          echo "| Nuxt | ${{ needs.nuxt-install.outputs.time }}ms |" >> $GITHUB_STEP_SUMMARY
